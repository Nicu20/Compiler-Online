@page "/compiler"
@using OnlineCompiler.Components
@using OnlineCompiler.Services
@inject CompilerService CompilerService

<CodeEditor Compile="OnCompile"/>
<CompilationPanel Errors="@compileErrors"/>
<ResultsPanel Output="@executionOutput"/>

@code{
    List<string>? compileErrors = new();
    string executionOutput = string.Empty;
    bool isCompiling = false;
    async Task OnCompile(string code)
    {
        isCompiling = true;
        compileErrors?.Clear();
        executionOutput = "";

        try
        {
            var compileResult = await CompilerService.CompileAsync(code);
            if(compileResult.Success)
            {
                var execResult = await CompilerService.ExecuteAsync(compileResult.Assembly!);
                executionOutput = execResult.Success ? execResult.Output : $"Error: {execResult.Error}";
            }
            else
            {
                compileErrors = compileResult.Errors;
            }
        }
        catch(Exception ex)
        {
            compileErrors?.Add($"Exception: {ex.Message}");
        }
        finally
        {
            isCompiling = false;
        }
    }
}